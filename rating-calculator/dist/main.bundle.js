!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=44)}([function(e,t){e.exports=React},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIString=t.LANG=void 0;const a=new URLSearchParams(document.location.search);let r="en";a.get("hl")?r=a.get("hl").startsWith("zh")?"zh":"en":navigator.language.startsWith("zh")&&(r="zh"),t.LANG=r;t.UIString={en:{gameVer:"Game version:",innerLvHeading:"Chart Inner Level Data",manualLv:"Manual input",autoLv:"Automatic",scoreInputHeading:"Player Score",scoreInputDescPrefix:'Please use "Analyze DX Rating" or "Download all scores" from ',bookmarketLinkLabel:"maimai bookmarklets",scoreInputDescSuffix:" to fill in this field.",computeRating:"Calculate Rating",analysisResult:"Analysis Result",newChartsRating:"New Charts Rating",oldChartsRating:"Old Charts Rating",grade:"Grade",ratingTargetDistribution:"Levels and Difficulties of Rating Subjects",column:":",subtotal:"Subtotal",newChartsRatingTargets:"New Charts Rating Subjects (best 15):",oldChartsRatingTargets:"Old Charts Rating Subjects (best 25):",newChartsRatingCandidates:"New Charts Rating Candidates:",oldChartsRatingCandidates:"Old Charts Rating Candidates:",num:"#",song:"Song",difficulty:"Difficulty",level:"Level",rankFactor:"Rank Factor",rating:"Rating",nextGoal:"Next Goal",nextRating:"Next Rating",rankFactorTable:"Rank Factor Table",rank:"Rank",achievement:"Achievement",achievementAbbr:"Achv",factor:"Factor",multiplier:"Multiplier (Factor × Achievement)",otherToolsHeading:"Other Tools",ratingVisualizer:"Rating Visualizer (Interactive Page)",bookmarketList:"Bookmarklets list",scoreConverter:"Convert DX score to old score system"},zh:{gameVer:"遊戲版本：",innerLvHeading:"譜面定數",manualLv:"手動輸入",autoLv:"自動代入",scoreInputHeading:"玩家成績輸入",scoreInputDescPrefix:"請用 ",bookmarketLinkLabel:"maimai 書籤小工具",scoreInputDescSuffix:" 中的「分析 DX Rating」或「下載所有歌曲成績」填入此欄。",computeRating:"計算 Rating 值",analysisResult:"分析結果",newChartsRating:"新譜面 Rating",oldChartsRating:"舊譜面 Rating",grade:"段位",ratingTargetDistribution:"Rating 對象曲等級與成績分布",column:"：",subtotal:"小計",newChartsRatingTargets:"新譜面 Rating 對象曲目 (取最佳 15 首)：",oldChartsRatingTargets:"舊譜面 Rating 對象曲目 (取最佳 25 首)：",newChartsRatingCandidates:"新譜面 Rating 候選曲目：",oldChartsRatingCandidates:"舊譜面 Rating 候選曲目：",num:"#",song:"歌曲",difficulty:"難度",level:"等級",rankFactor:"Rank 係數",rating:"R 值",nextGoal:"下個\n目標",nextRating:"下個\nR 值",rankFactorTable:"Rank 係數表",rank:"Rank",achievement:"達成率",achievementAbbr:"達成率",factor:"係數",multiplier:"倍率 (係數 × 達成率)",otherToolsHeading:"其他工具",ratingVisualizer:"R 值視覺化互動式網頁",bookmarketList:"書籤小工具列表",scoreConverter:"新舊版分數轉換 & 分析"}}[t.LANG]},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRankTitle=t.getRankByAchievement=t.getRankIndexByAchievement=t.getRankDefinitions=void 0;const a=[{th:100.5,factor:15,title:"SSS+"},{th:100,factor:14,title:"SSS"},{th:99.99,factor:13.5,title:"SS+"},{th:99.5,factor:13,title:"SS+"},{th:99,factor:12,title:"SS"},{th:98,factor:11,title:"S+"},{th:97,factor:10,title:"S"},{th:94,factor:9.4,title:"AAA"},{th:90,factor:9,title:"AA"},{th:80,factor:8,title:"A"},{th:75,factor:7.5,title:"BBB"},{th:70,factor:7,title:"BB"},{th:60,factor:6,title:"B"},{th:50,factor:5,title:"C"}],r=[{th:100.5,factor:14,title:"SSS+"},{th:100,factor:13.5,title:"SSS"},{th:99.5,factor:13.2,title:"SS+"},{th:99,factor:13,title:"SS"},{th:98,factor:12.7,title:"S+"},{th:97,factor:12.5,title:"S"},{th:94,factor:10.5,title:"AAA"},{th:90,factor:9.5,title:"AA"},{th:80,factor:8.5,title:"A"},{th:75,factor:7.5,title:"BBB"},{th:70,factor:7,title:"BB"},{th:60,factor:6,title:"B"},{th:50,factor:5,title:"C"}];function i(e){return e?r:a}function o(e,t){return i(t).findIndex(t=>e>=t.th)}function l(e,t){const n=o(e,t);return n<0?null:i(t)[n]}t.getRankDefinitions=i,t.getRankIndexByAchievement=o,t.getRankByAchievement=l,t.getRankTitle=function(e){const t=l(e,!0);return t?t.title:"C"}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DX_PLUS_GAME_VERSION=t.DX_GAME_VERSION=t.SSSPLUS_MIN_ACHIEVEMENT=t.OFFICIAL_LEVELS=t.DIFFICULTY_CLASSNAME_MAP=t.DIFFICULTIES=void 0,t.DIFFICULTIES=["BASIC","ADVANCED","EXPERT","MASTER","Re:MASTER"],t.DIFFICULTY_CLASSNAME_MAP=new Map([["Re:MASTER","remaster"],["MASTER","master"],["EXPERT","expert"],["ADVANCED","advanced"]]);t.OFFICIAL_LEVELS=[];for(let e=15;e>=1;e--)15!==e&&t.OFFICIAL_LEVELS.push(e+"+"),t.OFFICIAL_LEVELS.push(e.toString());t.SSSPLUS_MIN_ACHIEVEMENT=100.5,t.DX_GAME_VERSION=13,t.DX_PLUS_GAME_VERSION=14},,,,,,function(e,t,n){"use strict";function a(e,t){return e>t?-1:Number(e<t)}function r(e,t,n){return a(e[n],t[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.getSongsByNextRatingComparator=t.compareSongsByRating=void 0,t.compareSongsByRating=function(e,t){return r(e,t,"rating")||r(e,t,"level")||r(e,t,"achievement")},t.getSongsByNextRatingComparator=function(e){return(t,n)=>{const i=t.nextRanks.values().next().value,o=(i.minRt-e)/(i.rank.th-t.achievement),l=n.nextRanks.values().next().value;return a(o,(l.minRt-e)/(l.rank.th-n.achievement))||a(i,l)||r(t,n,"level")}}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreRow=void 0;const r=a(n(0)),i=["orderCell","songTitleCell","difficultyCell","innerLvCell","achievementCell","rankFactorCell","ratingCell"];class o extends r.default.PureComponent{constructor(){super(...arguments),this.getChildren=e=>e.includes("\n")?e.split("\n").map(e=>r.default.createElement("div",null,e)):e}render(){const{columnValues:e,isHeading:t}=this.props;let n="scoreRecordRow";return this.props.className&&(n+=" "+this.props.className),r.default.createElement("tr",{className:n},e.map((e,n)=>{const a="scoreRecordCell "+i[n],o=this.getChildren(e);return t?r.default.createElement("th",{className:a},o):r.default.createElement("td",{className:a},o)}))}}t.ScoreRow=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMinRank=t.getRankDistribution=t.mergeRecords=void 0;const a=n(3);function r(e){const t=new Map;for(const e of a.getRankDefinitions(!0))t.set(e.title,0);return e.forEach(e=>{const n=a.getRankTitle(e.achievement),r=t.get(n);t.set(n,r+1)}),t}t.mergeRecords=function(e){const{newChartRecords:t,newTopChartsCount:n,oldChartRecords:a,oldTopChartsCount:r}=e,i=t.slice(0,n),o=a.slice(0,r);return[].concat(i,o)},t.getRankDistribution=r,t.getMinRank=function(e){const t=r(e);let n;for(const[e,a]of t)a>0&&(n=e);return n}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RankDistributionDataRow=void 0;const r=a(n(0)),i=n(15);t.RankDistributionDataRow=r.default.memo(e=>{const t=[e.rowHead];let n=0;for(const[a,r]of e.rankDist)if(t.push(r),n+=r,a===e.minRank)break;return e.showTotal&&t.push(n),r.default.createElement(i.RankDistributionRow,{values:t,showTotal:e.showTotal,rowClassname:e.rowClassname,baseCellClassname:e.baseCellClassname,perColumnClassnames:e.perColumnClassnames})})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RankDistributionRow=void 0;const r=a(n(0));class i extends r.default.PureComponent{render(){const{values:e,isHeading:t,showTotal:n,rowClassname:a,baseCellClassname:i,perColumnClassnames:o}=this.props;return r.default.createElement("tr",{className:a},e.map((a,l)=>{const s=t||0===l;let u=i;return l<o.length&&(u+=" "+o[l]),n&&l===e.length-1&&(u+=" totalCell"),s?r.default.createElement("th",{className:u},a):r.default.createElement("td",{className:u},a)}))}}t.RankDistributionRow=i},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RankDistributionHeadRow=void 0;const r=a(n(0)),i=n(1),o=n(3),l=n(15);class s extends r.default.PureComponent{render(){const{minRank:e,showTotal:t,baseCellClassname:n,perColumnClassnames:a}=this.props,s=[""];for(const t of o.getRankDefinitions(!0))if(s.push(t.title),t.title===e)break;return t&&s.push(i.UIString.subtotal),r.default.createElement(l.RankDistributionRow,{values:s,isHeading:!0,showTotal:t,baseCellClassname:n,perColumnClassnames:a})}}t.RankDistributionHeadRow=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(0)),i=a(n(2)),o=n(45),l=n(1);document.title={zh:"maimai DX R 值分析工具",en:"maimai DX Rating Analyzer"}[l.LANG],i.default.render(r.default.createElement(o.RootComponent),document.getElementById("root"))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{s(a.next(e))}catch(e){i(e)}}function l(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}s((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=void 0;const i=r(n(0)),o=n(46),l=n(1),s=n(47),u=n(48),c=n(49),d=n(50),f=n(5),h=n(51),m=n(52),g=n(53),p=n(54),R=n(55),v=n(67),C=n(68);class b extends i.default.PureComponent{constructor(e){super(e),this.playerGradeIndex=0,this.lvInput=i.default.createRef(),this.scoreInput=i.default.createRef(),this.selectVersion=e=>{this.setState({isDxPlus:e===f.DX_PLUS_GAME_VERSION})},this.analyzeRating=e=>a(this,void 0,void 0,(function*(){e&&e.preventDefault();const t=this.lvInput.current?this.lvInput.current.getInput():"",n=this.scoreInput.current?this.scoreInput.current.getInput():"",{isDxPlus:r}=this.state;console.log("isDxPlus",r);const i=yield function(e,t){const n=e=>{const t=e.split("\n"),n=new Map;for(const e of t){const t=s.parseInnerLevelLine(e);t&&(n.has(t.songName)||n.set(t.songName,[]),n.get(t.songName).push(t))}return n};return new Promise(a=>{if(t.length>0)return void a(n(t));const r=function(e){return e?"dxPlusInnerLv":"dxInnerLv"}(e),i=o.readFromCache(r);i?a(n(i)):(console.log("Magic happening..."),fetch(u.iWantSomeMagic(e)).then(e=>e.text()).then(e=>{o.writeToCache(r,e),a(n(e))}))})}(r,t);console.log("Song properties:",i);const l=yield function(e,t){return a(this,void 0,void 0,(function*(){const n=e.split("\n"),a=[];for(const e of n){const n=c.parseScoreLine(e,t);n&&a.push(n)}return a}))}(n,r);if(console.log("Player scores:",l),!l.length)return void this.setState({ratingData:void 0,showMultiplierTable:!0});const h=r?f.DX_PLUS_GAME_VERSION:f.DX_GAME_VERSION,m=yield d.analyzePlayerRating(i,l,h);console.log("Rating Data:",m),this.setState({ratingData:m,showMultiplierTable:!0})}));const t=new URLSearchParams(document.location.search);let n=t.get("gameVersion")===f.DX_PLUS_GAME_VERSION.toString(),r="hide"!==t.get("quickLookup");this.state={isDxPlus:n,showMultiplierTable:r},this.initWindowCommunication()}render(){const{isDxPlus:e,showMultiplierTable:t,ratingData:n}=this.state;return i.default.createElement(i.default.Fragment,null,i.default.createElement(C.VersionSelect,{isDxPlus:e,handleVersionSelect:this.selectVersion}),i.default.createElement(h.InnerLvInput,{ref:this.lvInput}),i.default.createElement(v.ScoreInput,{ref:this.scoreInput}),i.default.createElement("div",{className:"actionArea"},i.default.createElement("button",{className:"analyzeRatingBtn",onClick:this.analyzeRating},l.UIString.computeRating)),i.default.createElement("hr",{className:"sectionSep"}),n&&i.default.createElement(R.RatingOutput,{isDxPlus:e,ratingData:n,playerGradeIndex:this.playerGradeIndex}),t&&i.default.createElement(m.MultiplierTable,{isDxPlus:e}),i.default.createElement(g.OtherTools,null),i.default.createElement(p.PageFooter,null))}initWindowCommunication(){if(window.opener){window.addEventListener("message",e=>{var t;if(console.log(e.origin,e.data.action,"string"==typeof(t=e.data.payload)?"string of length "+t.length:t),"https://maimaidx-eng.com"===e.origin||"https://maimaidx.jp"===e.origin){let t;switch(e.data.action){case"gameVersion":t=parseInt(e.data.payload),t>=f.DX_PLUS_GAME_VERSION&&this.setState({isDxPlus:!0});break;case"playerGrade":t=parseInt(e.data.payload),t&&(this.playerGradeIndex=t);break;case"replacePlayerScore":this.scoreInput.current.setText(e.data.payload);break;case"appendPlayerScore":this.scoreInput.current.appendText(e.data.payload);break;case"calculateRating":this.analyzeRating()}}});const e=document.referrer&&new URL(document.referrer).origin;e?window.opener.postMessage("ready",e):(window.opener.postMessage("ready","https://maimaidx-eng.com"),window.opener.postMessage("ready","https://maimaidx.jp"))}}}t.RootComponent=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeToCache=t.readFromCache=void 0;t.readFromCache=function(e){const t=window.localStorage.getItem(e);if(console.log('Reading cache for "'+e+'" =>',t),!t)return null;const n=JSON.parse(t),a=new Date(n.date);return(new Date).valueOf()-a.valueOf()>6048e5?(console.warn('Cache for "'+e+'" is expired.'),window.localStorage.removeItem(e),null):n.content},t.writeToCache=function(e,t){console.log('Updating cache for "'+e+'"');const n={date:new Date,content:t};window.localStorage.setItem(e,JSON.stringify(n))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseInnerLevelLine=void 0;const a=/\bdx\s*:\s*([0-9]+)/,r=/\blv\s*:\s*(\[.+?\])/,i=/\bv\s*:\s*([0-9]+)/,o=/\bn\s*:\s*["'](.+?)['"]\s*[,\}]/,l=/\bnn\s*:\s*["'](.+?)['"]\s*[,\}]/;t.parseInnerLevelLine=function(e){const t=e.match(a),n=e.match(r),s=e.match(i),u=e.match(o),c=e.match(l);if(t&&n&&s&&u)return{dx:parseInt(t[1]),lv:JSON.parse(n[1]),debut:parseInt(s[1]),songName:u[1],nickname:c&&c[1]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iWantSomeMagic=void 0;const a=[105,117,117,113,116,59,48,48,116,104,106,110,102,115,98,47,104,106,117,105,118,99,47,106,112,48,110,98,106,96,83,98,117,106,111,104,66,111,98,109,122,123,102,115,48,116,100,115,106,113,117,116,96,110,98,106,110,98,106,48,106,111,96,109,119,96,101,121,47,107,116],r=[113,109,118,116];t.iWantSomeMagic=function(e){const t=a.map(e=>e-1);return e&&t.splice(t.length-3,0,...r.map(e=>e-1)),String.fromCharCode(...t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseScoreLine=void 0;const a=n(3),r=n(5);function i(e){if(!e)return 1;const t=parseInt(e);return e.endsWith("+")?t+.7:t}t.parseScoreLine=function(e,t){const[n,o,l,s,u,c]=e.split("\t");if(n&&o&&l&&s&&u&&c){const e=parseFloat(c),d=function(e,t){e=Math.min(e,r.SSSPLUS_MIN_ACHIEVEMENT);const n=a.getRankByAchievement(e,t);n||console.warn(`Could not find rank for achievement ${e.toFixed(4)}%`);const i=n?n.factor:5;return{factor:i,multiplier:i*e/100}}(e,t);return{songName:n,genre:o,difficulty:l,level:i(s),levelIsEstimate:!0,chartType:u,achievement:e,multiplier:d.multiplier,rankFactor:d.factor}}}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{s(a.next(e))}catch(e){i(e)}}function l(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}s((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzePlayerRating=void 0;const r=n(11),i=n(5);function o(e){return"DX"===e}function l(e,t,n){return"Link"===e?t.includes("niconico")?"Link(nico)":"Link(org)":o(n)?e+"[dx]":e}function s(e,t,n,a){let r=e.get(t);if(r&&r.length>0){if(r.length>1){const e=o(a)?1:0;if(r=r.filter(t=>t.dx===e),r.length>1){const e=l(t,n);r=r.filter(t=>t.nickname===e)}}if(1===r.length)return r[0]}return console.warn("Could not find song properties for "+t),null}function u(e,t){if(t){const n=i.DIFFICULTIES.indexOf(e.difficulty),a=t.lv[n];"number"==typeof a&&(e.levelIsEstimate=a<0,e.level=Math.abs(a))}if(e.levelIsEstimate){const t=l(e.songName,e.genre,e.chartType)+" - "+e.difficulty+" "+e.level;console.warn("Missing inner lv data for "+t)}return Object.assign(Object.assign({},e),{rating:e.level*e.multiplier})}t.analyzePlayerRating=function(e,t,n){return a(this,void 0,void 0,(function*(){const a=[],i=[];for(const r of t){const t=s(e,r.songName,r.genre,r.chartType);let o="STANDARD"===r.chartType;t&&(o=t.debut!==n);const l=u(r,t);o?i.push(l):a.push(l)}a.sort(r.compareSongsByRating),i.sort(r.compareSongsByRating);let o=0;const l=Math.min(15,a.length);for(let e=0;e<l;e++)o+=Math.floor(a[e].rating);let c=0;const d=Math.min(25,i.length);for(let e=0;e<d;e++)c+=Math.floor(i[e].rating);return{newChartRecords:a,newChartsRating:o,newTopChartsCount:l,oldChartRecords:i,oldChartsRating:c,oldTopChartsCount:d}}))}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InnerLvInput=void 0;const r=a(n(0)),i=n(1);class o extends r.default.PureComponent{constructor(){super(...arguments),this.state={showTextarea:!1},this.textareaRef=r.default.createRef(),this.handleRadioChange=e=>{this.setState({showTextarea:"1"===e.currentTarget.value})}}render(){const{showTextarea:e}=this.state;return r.default.createElement("div",{className:"w90"},r.default.createElement("h2",{className:"lvInputHeading"},i.UIString.innerLvHeading),r.default.createElement("form",null,r.default.createElement("label",{className:"lvFormLabel"},r.default.createElement("input",{className:"lvFormRadio",name:"showLvInput",value:"0",type:"radio",checked:!e,onChange:this.handleRadioChange}),i.UIString.autoLv),r.default.createElement("label",{className:"lvFormLabel"},r.default.createElement("input",{className:"lvFormRadio",name:"showLvInput",value:"1",type:"radio",checked:e,onChange:this.handleRadioChange}),i.UIString.manualLv)),e&&r.default.createElement("textarea",{className:"lvInput",ref:this.textareaRef}))}getInput(){return this.textareaRef.current?this.textareaRef.current.value:""}}t.InnerLvInput=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MultiplierTable=void 0;const r=a(n(0)),i=n(1),o=n(3),l=["qlRankTitleCell","qlThresholdCell"],s=e=>{const{isHeading:t}=e;return r.default.createElement("tr",null,e.values.map((e,n)=>{let a="qlRankFactorCell";return n<l.length&&(a+=" "+l[n]),t||0===n?r.default.createElement("th",{className:a},e):r.default.createElement("td",{className:a},e)}))};class u extends r.default.PureComponent{constructor(){super(...arguments),this.state={minRankOption:"A"}}render(){const{isDxPlus:e}=this.props,{minRankOption:t}=this.state,n=o.getRankDefinitions(e),a=n.findIndex(e=>e.title===t)+1;return r.default.createElement("div",{className:"quickLookup"},r.default.createElement("h2",{className:"quickLookupHeading"},i.UIString.rankFactorTable),r.default.createElement("table",{className:"quickLookupTable"},r.default.createElement("thead",null,r.default.createElement(s,{values:[i.UIString.rank,i.UIString.achievement,i.UIString.factor,i.UIString.multiplier],isHeading:!0})),r.default.createElement("tbody",null,n.slice(0,a).map((e,t,n)=>{const a=e.th*e.factor/100,i=t>0?(n[t-1].th-1e-4)*e.factor/100:a,o=a.toFixed(3),l=i.toFixed(3),u=o!==l?`${o} - ${l}`:o;return r.default.createElement(s,{values:[e.title,e.th,e.factor,u]})}))),r.default.createElement("hr",{className:"sectionSep"}))}}t.MultiplierTable=u},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OtherTools=void 0;const r=a(n(0)),i=n(1);class o extends r.default.PureComponent{render(){return r.default.createElement("div",{className:"otherToolsContainer"},r.default.createElement("h2",{className:"otherToolsHeading"},i.UIString.otherToolsHeading),r.default.createElement("ul",null,r.default.createElement("li",{className:"toolItem"},r.default.createElement("a",{href:"../rating-visualizer/"},i.UIString.ratingVisualizer)),r.default.createElement("li",{className:"toolItem"},r.default.createElement("a",{href:"../bookmarklets/"},i.UIString.bookmarketList)),r.default.createElement("li",{className:"toolItem"},r.default.createElement("a",{href:"../"},i.UIString.scoreConverter))),r.default.createElement("hr",{className:"sectionSep"}))}}t.OtherTools=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageFooter=void 0;const r=a(n(0));class i extends r.default.PureComponent{render(){return r.default.createElement("footer",null,"Made by"," ",r.default.createElement("a",{className:"authorLink",href:"https://github.com/myjian/"},"myjian"),".")}}t.PageFooter=i},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RatingOutput=void 0;const r=a(n(0)),i=n(1),o=n(85),l=n(58),s=n(61),u=n(62),c=n(65);class d extends r.default.PureComponent{constructor(){super(...arguments),this.outputArea=r.default.createRef(),this.state={hideNewTopSongs:!1,hideOldTopSongs:!1,hideNewCandidateSongs:!1,hideOldCandidateSongs:!1},this.toggleNewTopChartsDisplay=()=>{this.setState(e=>({hideNewTopSongs:!e.hideNewTopSongs}))},this.toggleNewCandidateChartsDisplay=()=>{this.setState(e=>({hideNewCandidateSongs:!e.hideNewCandidateSongs}))},this.toggleOldTopChartsDisplay=()=>{this.setState(e=>({hideOldTopSongs:!e.hideOldTopSongs}))},this.toggleOldCandidateChartsDisplay=()=>{this.setState(e=>({hideOldCandidateSongs:!e.hideOldCandidateSongs}))}}componentDidMount(){this.outputArea.current&&this.outputArea.current.scrollIntoView({behavior:"smooth"})}render(){const{isDxPlus:e,playerGradeIndex:t}=this.props,{newChartRecords:n,newChartsRating:a,newTopChartsCount:d,oldChartRecords:f,oldChartsRating:h,oldTopChartsCount:m}=this.props.ratingData,{hideNewCandidateSongs:g,hideNewTopSongs:p,hideOldCandidateSongs:R,hideOldTopSongs:v}=this.state;return r.default.createElement("div",{className:"outputArea",ref:this.outputArea},r.default.createElement("h2",{id:"outputHeading"},i.UIString.analysisResult),r.default.createElement(c.RatingOverview,{newChartsRating:a,oldChartsRating:h,isDxPlus:e,playerGradeIndex:t}),r.default.createElement("div",{className:"ratingTargetDistribution"},r.default.createElement("h3",null,i.UIString.ratingTargetDistribution),r.default.createElement("div",{className:"flexRow"},r.default.createElement(u.LevelRankDistribution,{newChartRecords:n,newTopChartsCount:d,oldChartRecords:f,oldTopChartsCount:m}),r.default.createElement(s.DifficultyRankDistribution,{newChartRecords:n,newTopChartsCount:d,oldChartRecords:f,oldTopChartsCount:m}))),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(o.ChartRecordSectionTitle,{title:i.UIString.newChartsRatingTargets,contentHidden:p,onClick:this.toggleNewTopChartsDisplay}),r.default.createElement(l.ChartRecordsTable,{isDxPlus:e,records:n,count:d,hidden:p})),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(o.ChartRecordSectionTitle,{title:i.UIString.oldChartsRatingTargets,contentHidden:v,onClick:this.toggleOldTopChartsDisplay}),r.default.createElement(l.ChartRecordsTable,{isDxPlus:e,records:f,count:m,hidden:v})),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(o.ChartRecordSectionTitle,{title:i.UIString.newChartsRatingCandidates,contentHidden:g,onClick:this.toggleNewCandidateChartsDisplay,isCandidateList:!0}),r.default.createElement(l.ChartRecordsTable,{isDxPlus:e,records:n,offset:d,isCandidate:!0,hidden:g})),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(o.ChartRecordSectionTitle,{title:i.UIString.oldChartsRatingCandidates,contentHidden:R,onClick:this.toggleOldCandidateChartsDisplay,isCandidateList:!0}),r.default.createElement(l.ChartRecordsTable,{isDxPlus:e,records:f,offset:m,isCandidate:!0,hidden:R})),r.default.createElement("hr",{className:"sectionSep"}))}}t.RatingOutput=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCandidateSongs=void 0;const a=n(3),r=n(57),i=n(11),o=n(5);function l(e,t,n){const i=a.getRankIndexByAchievement(e.achievement,t),o=new Map;if(i<=0)return o;const l=a.getRankDefinitions(t);for(let a=i-1;a>=0;a--){const i=l[a];if(i.title===l[a+1].title)continue;const[s,u]=r.calculateRatingRange(e.level,i,t);u>=n&&o.set(i.title,{minRt:s,rank:i})}return o}t.getCandidateSongs=function(e,t,n){const a=[];if(t<=0)return a;const r=e[t-1].rating;for(let i=t;i<e.length;i++){const t=e[i];if(t.achievement<o.SSSPLUS_MIN_ACHIEVEMENT){const e=l(t,n,r);if(!e.size)continue;if(t.nextRanks=e,a.push(t),a.length>=50)break}}return a.sort(i.getSongsByNextRatingComparator(r-10)),a.slice(0,20)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateRatingRange=void 0;const a=n(3);t.calculateRatingRange=function(e,t,n){const r=a.getRankDefinitions(n),i=r.indexOf(t),o=i>=1?r[i-1].th-1e-4:t.th;return[Math.floor(e*t.th*t.factor/100),Math.floor(e*o*t.factor/100)]}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordsTable=void 0;const r=a(n(0)),i=n(56),o=n(59),l=n(60);t.ChartRecordsTable=r.default.memo(e=>{const{isCandidate:t,isDxPlus:n,count:a,hidden:s}=e;let{offset:u,records:c}=e;u&&(c=t?i.getCandidateSongs(c,u,n):c.slice(u)),a&&(c=c.slice(0,a));const d=t?"songRecordTable candidateTable":"songRecordTable topRecordTable";let f="songRecordTableContainer";return s&&(f+=" hidden"),r.default.createElement("div",{className:f},r.default.createElement("table",{className:d},r.default.createElement("thead",null,r.default.createElement(l.ScoreHeadRow,{isCandidate:t})),r.default.createElement("tbody",null,c.map((e,n)=>r.default.createElement(o.ScoreDataRow,{record:e,isCandidate:t,index:n+1})))))})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreDataRow=void 0;const r=a(n(0)),i=n(3),o=n(5),l=n(12);t.ScoreDataRow=r.default.memo(e=>{const{record:t,isCandidate:n,index:a}=e;let s=t.level.toFixed(1);t.levelIsEstimate&&(s="*"+s);const u=n?t.nextRanks.keys().next().value:`${i.getRankTitle(t.achievement)} (${t.rankFactor})`,c=n?t.nextRanks.values().next().value.minRt.toFixed(0):Math.floor(t.rating).toString(),d=[a.toString(),t.songName,t.difficulty,s,t.achievement.toFixed(4)+"%",u,c];return r.default.createElement(l.ScoreRow,{className:o.DIFFICULTY_CLASSNAME_MAP.get(t.difficulty),columnValues:d})})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreHeadRow=void 0;const r=a(n(0)),i=n(1),o=n(12);t.ScoreHeadRow=r.default.memo(({isCandidate:e})=>{const t=[i.UIString.num,i.UIString.song,i.UIString.difficulty,i.UIString.level,i.UIString.achievementAbbr,e?i.UIString.nextGoal:i.UIString.rankFactor,e?i.UIString.nextRating:i.UIString.rating];return r.default.createElement(o.ScoreRow,{columnValues:t,isHeading:!0})})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DifficultyRankDistribution=void 0;const r=a(n(0)),i=n(13),o=n(5),l=n(14),s=n(16);class u extends r.default.PureComponent{render(){const e=i.mergeRecords(this.props),t=i.getMinRank(e),n=function(e){const t=new Map;for(let e=o.DIFFICULTIES.length-1;e>=0;e--)t.set(o.DIFFICULTIES[e],[]);for(const n of e)t.get(n.difficulty).push(n);for(let e=o.DIFFICULTIES.length-1;e>=0;e--)t.get(o.DIFFICULTIES[e]).length||t.delete(o.DIFFICULTIES[e]);return t}(e);return r.default.createElement("table",{className:"rankDistributionTable"},r.default.createElement("thead",null,r.default.createElement(s.RankDistributionHeadRow,{minRank:t,baseCellClassname:"diffRankCell",perColumnClassnames:["difficultyRankDistHead"],showTotal:!0})),r.default.createElement("tbody",null,Array.from(n.entries()).map(([e,n])=>r.default.createElement(l.RankDistributionDataRow,{key:e,rowHead:e,minRank:t,showTotal:!0,rankDist:i.getRankDistribution(n),rowClassname:o.DIFFICULTY_CLASSNAME_MAP.get(e),baseCellClassname:"diffRankCell",perColumnClassnames:[]}))))}}t.DifficultyRankDistribution=u},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LevelRankDistribution=void 0;const r=a(n(0)),i=n(63),o=n(64),l=n(13),s=n(14),u=n(16),c=["officialLevelCell"];class d extends r.default.PureComponent{render(){const e=l.mergeRecords(this.props),t=l.getMinRank(e),n=function(e){const t=e.map(e=>e.level);t.sort(o.compareNumber),t.reverse();const n=new Map;for(const e of t){const t=i.getOfficialLevel(e);n.has(t)||n.set(t,[])}for(const t of e)n.get(i.getOfficialLevel(t.level)).push(t);return n}(e);return r.default.createElement("table",{className:"rankDistributionTable"},r.default.createElement("thead",null,r.default.createElement(u.RankDistributionHeadRow,{minRank:t,baseCellClassname:"levelRankCell",perColumnClassnames:c})),r.default.createElement("tbody",null,Array.from(n.entries()).map(([e,n])=>r.default.createElement(s.RankDistributionDataRow,{key:e,rowHead:e,minRank:t,rankDist:l.getRankDistribution(n),baseCellClassname:"levelRankCell",perColumnClassnames:c}))))}}t.LevelRankDistribution=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOfficialLevel=void 0;t.getOfficialLevel=function(e){const t=Math.floor(e);return e-t>.6?t+"+":t.toString()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compareNumber=void 0,t.compareNumber=function(e,t){return e>t?1:e<t?-1:0}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RatingOverview=void 0;const r=a(n(0)),i=n(66),o=n(1);class l extends r.default.PureComponent{render(){const{oldChartsRating:e,newChartsRating:t,playerGradeIndex:n,isDxPlus:a}=this.props;let l=t+e;const s=n>0?i.getGradeByIndex(n,a):null;return s&&(l+=s.bonus),r.default.createElement("div",{className:"ratingOverview"},r.default.createElement("div",{className:"totalRatingRow"},"Rating： ",r.default.createElement("span",null,l)),r.default.createElement("table",null,r.default.createElement("tbody",null,r.default.createElement("tr",null,r.default.createElement("td",null,o.UIString.newChartsRating),r.default.createElement("td",{className:"columnColumn"},o.UIString.column),r.default.createElement("td",null,t)),r.default.createElement("tr",null,r.default.createElement("td",null,o.UIString.oldChartsRating),r.default.createElement("td",null,o.UIString.column),r.default.createElement("td",null,e)),s&&r.default.createElement("tr",null,r.default.createElement("td",null,o.UIString.grade," (",r.default.createElement("span",null,s.title),")"),r.default.createElement("td",null,o.UIString.column),r.default.createElement("td",null,s.bonus)))))}}t.RatingOverview=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGradeByIndex=void 0;const a=[{title:"",bonus:0},{title:"初心者",bonus:0},{title:"見習い",bonus:100},{title:"駆け出し",bonus:200},{title:"修行中",bonus:300},{title:"初段",bonus:400},{title:"二段",bonus:500},{title:"三段",bonus:600},{title:"四段",bonus:700},{title:"五段",bonus:800},{title:"六段",bonus:900},{title:"七段",bonus:1e3},{title:"八段",bonus:1200},{title:"九段",bonus:1400},{title:"十段",bonus:1600},{title:"皆伝",bonus:1800},{title:"壱皆伝",bonus:2e3},{title:"弐皆伝",bonus:2100},{title:"参皆伝",bonus:2100},{title:"肆皆伝",bonus:2100},{title:"伍皆伝",bonus:2100},{title:"陸皆伝",bonus:2100},{title:"漆皆伝",bonus:2100},{title:"捌皆伝",bonus:2100},{title:"玖皆伝",bonus:2100},{title:"拾皆伝",bonus:2100}],r=[{title:"",bonus:0},{title:"初心者",bonus:0},{title:"見習い",bonus:250},{title:"駆け出し",bonus:500},{title:"修行中",bonus:750},{title:"初段",bonus:1e3},{title:"二段",bonus:1200},{title:"三段",bonus:1400},{title:"四段",bonus:1500},{title:"五段",bonus:1600},{title:"六段",bonus:1700},{title:"七段",bonus:1800},{title:"八段",bonus:1850},{title:"九段",bonus:1900},{title:"十段",bonus:1950},{title:"皆伝",bonus:2e3},{title:"壱皆伝",bonus:2010},{title:"弐皆伝",bonus:2020},{title:"参皆伝",bonus:2030},{title:"肆皆伝",bonus:2040},{title:"伍皆伝",bonus:2050},{title:"陸皆伝",bonus:2060},{title:"漆皆伝",bonus:2070},{title:"捌皆伝",bonus:2080},{title:"玖皆伝",bonus:2090},{title:"拾皆伝",bonus:2100}];t.getGradeByIndex=function(e,t){return(t?r:a)[e]}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreInput=void 0;const r=a(n(0)),i=n(1);class o extends r.default.PureComponent{constructor(){super(...arguments),this.textareaRef=r.default.createRef()}render(){return r.default.createElement("div",{className:"w90"},r.default.createElement("h2",{className:"scoreInputHeading"},i.UIString.scoreInputHeading),r.default.createElement("div",null,i.UIString.scoreInputDescPrefix,r.default.createElement("a",{href:"/mai-tools/bookmarklets/",target:"_blank"},i.UIString.bookmarketLinkLabel),i.UIString.scoreInputDescSuffix),r.default.createElement("textarea",{className:"scoreInputArea",ref:this.textareaRef}))}getInput(){return this.textareaRef.current?this.textareaRef.current.value:""}setText(e){this.textareaRef.current&&(this.textareaRef.current.value=e)}appendText(e){this.textareaRef.current&&(this.textareaRef.current.value+=e+"\n")}}t.ScoreInput=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VersionSelect=void 0;const r=a(n(0)),i=n(1);class o extends r.default.PureComponent{constructor(){super(...arguments),this.handleChange=e=>{this.props.handleVersionSelect(parseInt(e.currentTarget.value))}}render(){const{isDxPlus:e}=this.props;return r.default.createElement("label",null,i.UIString.gameVer,r.default.createElement("select",{className:"gameVersion",onChange:this.handleChange},r.default.createElement("option",{value:"13",selected:!e},"DX"),r.default.createElement("option",{value:"14",selected:e},"DX Plus")))}}t.VersionSelect=o},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordSectionTitle=void 0;const r=a(n(0));class i extends r.default.PureComponent{constructor(){super(...arguments),this.handleClick=e=>{e.preventDefault(),this.props.onClick(e)},this.handleKeyPress=e=>{e.preventDefault(),console.log(e.key),console.log(e.keyCode),"Enter"===e.key&&this.props.onClick(e)}}render(){const{isCandidateList:e,contentHidden:t,title:n}=this.props,a=e?"▶":"▷";let i="crSecTitleSymbol";return t&&(i+=" crSecHidden"),r.default.createElement("div",{className:"crSecTitle",tabIndex:0,onClick:this.handleClick,onKeyPress:this.handleKeyPress},r.default.createElement("span",{className:i},a)," ",n)}}t.ChartRecordSectionTitle=i}]);
!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}([function(e,t){e.exports=React},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRankTitle=t.getRankByAchievement=t.getRankIndexByAchievement=t.getRankDefinitions=void 0;const a=[{th:100.5,factor:15,title:"SSS+"},{th:100,factor:14,title:"SSS"},{th:99.99,factor:13.5,title:"SS+"},{th:99.5,factor:13,title:"SS+"},{th:99,factor:12,title:"SS"},{th:98,factor:11,title:"S+"},{th:97,factor:10,title:"S"},{th:94,factor:9.4,title:"AAA"},{th:90,factor:9,title:"AA"},{th:80,factor:8,title:"A"},{th:75,factor:7.5,title:"BBB"},{th:70,factor:7,title:"BB"},{th:60,factor:6,title:"B"},{th:50,factor:5,title:"C"}],o=[{th:100.5,factor:14,title:"SSS+"},{th:100,factor:13.5,title:"SSS"},{th:99.5,factor:13.2,title:"SS+"},{th:99,factor:13,title:"SS"},{th:98,factor:12.7,title:"S+"},{th:97,factor:12.5,title:"S"},{th:94,factor:10.5,title:"AAA"},{th:90,factor:9.5,title:"AA"},{th:80,factor:8.5,title:"A"},{th:75,factor:7.5,title:"BBB"},{th:70,factor:7,title:"BB"},{th:60,factor:6,title:"B"},{th:50,factor:5,title:"C"}];function r(e){return e?o:a}function l(e,t){return r(t).findIndex(t=>e>=t.th)}function i(e,t){const n=l(e,t);return n<0?null:r(t)[n]}t.getRankDefinitions=r,t.getRankIndexByAchievement=l,t.getRankByAchievement=i,t.getRankTitle=function(e){const t=i(e,!0);return t?t.title:"C"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DX_PLUS_GAME_VERSION=t.DX_GAME_VERSION=t.SSSPLUS_MIN_ACHIEVEMENT=t.OFFICIAL_LEVELS=t.DIFFICULTY_CLASSNAME_MAP=t.DIFFICULTIES=void 0,t.DIFFICULTIES=["BASIC","ADVANCED","EXPERT","MASTER","Re:MASTER"],t.DIFFICULTY_CLASSNAME_MAP=new Map([["Re:MASTER","remaster"],["MASTER","master"],["EXPERT","expert"],["ADVANCED","advanced"]]);t.OFFICIAL_LEVELS=[];for(let e=15;e>=1;e--)15!==e&&t.OFFICIAL_LEVELS.push(e+"+"),t.OFFICIAL_LEVELS.push(e.toString());t.SSSPLUS_MIN_ACHIEVEMENT=100.5,t.DX_GAME_VERSION=13,t.DX_PLUS_GAME_VERSION=14},function(e,t){e.exports=ReactDOM},,,,,function(e,t,n){"use strict";function a(e,t){return e>t?-1:Number(e<t)}function o(e,t,n){return a(e[n],t[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.getSongsByNextRatingComparator=t.compareSongsByRating=void 0,t.compareSongsByRating=function(e,t){return o(e,t,"rating")||o(e,t,"level")||o(e,t,"achievement")},t.getSongsByNextRatingComparator=function(e){return(t,n)=>{const r=t.nextRanks.values().next().value,l=(r.minRt-e)/(r.rank.th-t.achievement),i=n.nextRanks.values().next().value;return a(l,(i.minRt-e)/(i.rank.th-n.achievement))||a(r,i)||o(t,n,"level")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIString=void 0;const a=new URLSearchParams(document.location.search);let o="en";a.get("hl")?o=a.get("hl").startsWith("zh")?"zh":"en":navigator.language.startsWith("zh")&&(o="zh");t.UIString={en:{innerLvHeading:"Chart Inner Level Data",manualLv:"Manual input",autoLv:"Automatic",scoreInputHeading:"Player Score",scoreInputDescPrefix:'Please use "Calculate DX Rating" or "Download Scores" from ',bookmarketLinkLabel:"maimai bookmarklets",scoreInputDescSuffix:" to fill this field.",otherToolsHeading:"Other Tools",ratingVisualizer:"Rating Visualizer (Interactive Page)",bookmarketList:"Bookmarklets list",scoreConverter:"Convert DX score to old score system",grade:"Grade",column:":",newChartsRating:"New charts rating",oldChartsRating:"Old charts rating",analysisResult:"Analysis Result"},zh:{innerLvHeading:"譜面定數",manualLv:"手動輸入",autoLv:"自動代入",scoreInputHeading:"玩家成績輸入",scoreInputDescPrefix:"請用 ",bookmarketLinkLabel:"maimai 書籤小工具",scoreInputDescSuffix:" 中的「分析 DX Rating」或「下載所有歌曲成績」填入此欄。",otherToolsHeading:"其他工具",ratingVisualizer:"R 值視覺化互動式網頁",bookmarketList:"書籤小工具列表",scoreConverter:"DX 分數轉換與分析工具",grade:"段位",column:"：",newChartsRating:"新譜面 Rating",oldChartsRating:"舊譜面 Rating",analysisResult:"分析結果"}}[o]},,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(n(0)),r=a(n(3)),l=n(31);r.default.render(o.default.createElement(l.RootComponent),document.getElementById("root"))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function l(e){try{s(a.next(e))}catch(e){r(e)}}function i(e){try{s(a.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}s((a=a.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=void 0;const r=o(n(0)),l=n(32),i=n(33),s=n(9),c=n(36),u=n(37),d=n(38),f=n(39),m=n(40),h=n(41),g=n(2),p=n(42),S=n(43),v=n(46),E=n(47),b=n(48),R=n(44),I=n(45);function y(e,t,n){return a(this,void 0,void 0,(function*(){console.log("isDxPlus",e);const o=yield function(e,t){const n=e=>{const t=e.split("\n"),n=new Map;for(const e of t){const t=c.parseInnerLevelLine(e);t&&(n.has(t.songName)||n.set(t.songName,[]),n.get(t.songName).push(t))}return n};return new Promise(a=>{if(t.length>0)return void a(n(t));const o=e?"dxPlusInnerLv":"dxInnerLv",r=l.readFromCache(o);r?a(n(r)):(console.log("Magic happening..."),fetch(u.iWantSomeMagic(e)).then(e=>e.text()).then(e=>{l.writeToCache(o,e),a(n(e))}))})}(e,t);console.log("Song properties:",o);const r=yield function(e,t){return a(this,void 0,void 0,(function*(){const n=e.split("\n"),a=[];for(const e of n){const n=d.parseScoreLine(e,t);n&&a.push(n)}return a}))}(n,e);if(console.log("Player scores:",r),!r.length)return;const s=e?g.DX_PLUS_GAME_VERSION:g.DX_GAME_VERSION,p=yield m.analyzePlayerRating(o,r,s);console.log("Rating Data:",p);const S=p.newSongScores.slice(0,p.newTopChartsCount),v=p.oldSongScores.slice(0,p.oldTopChartsCount),E=[].concat(S,v);f.renderRankDistributionPerLevel(E,document.getElementById("lrDistThead"),document.getElementById("lrDistTbody")),f.renderRankDistributionPerDifficulty(E,document.getElementById("drDistThead"),document.getElementById("drDistTbody")),h.renderSongScores(S,!1,document.getElementById("newTopSongsThead"),document.getElementById("newTopSongsTbody")),h.renderSongScores(v,!1,document.getElementById("oldTopSongsThead"),document.getElementById("oldTopSongsTbody"));const b=i.getCandidateSongs(p.newSongScores,p.newTopChartsCount,e),R=i.getCandidateSongs(p.oldSongScores,p.oldTopChartsCount,e);h.renderSongScores(b,!0,document.getElementById("newCandidateSongsThead"),document.getElementById("newCandidateSongsTbody")),h.renderSongScores(R,!0,document.getElementById("oldCandidateSongsThead"),document.getElementById("oldCandidateSongsTbody"));const I=document.querySelector(".outputArea");return I.classList.remove("hidden"),I.scrollIntoView({behavior:"smooth"}),document.querySelector(".quickLookup").classList.remove("hidden"),p}))}class _ extends r.default.PureComponent{constructor(e){super(e),this.playerGradeIndex=0,this.lvInput=r.default.createRef(),this.scoreInput=r.default.createRef(),this.selectVersion=e=>{this.setState({isDxPlus:e===g.DX_PLUS_GAME_VERSION})},this.handleButtonClick=e=>{e.preventDefault(),this.calculateAndShowRating()},this.initWindowCommunication=()=>{if(window.opener){window.addEventListener("message",e=>{if(console.log(e.origin,e.data),"https://maimaidx-eng.com"===e.origin||"https://maimaidx.jp"===e.origin){let t;switch(e.data.action){case"gameVersion":t=parseInt(e.data.payload),t>=g.DX_PLUS_GAME_VERSION&&this.setState({isDxPlus:!0});break;case"playerGrade":t=parseInt(e.data.payload),t&&(this.playerGradeIndex=t);break;case"replacePlayerScore":this.scoreInput.current.setText(e.data.payload);break;case"appendPlayerScore":this.scoreInput.current.appendText(e.data.payload);break;case"calculateRating":this.calculateAndShowRating()}}});const e=document.referrer&&new URL(document.referrer).origin;e?window.opener.postMessage("ready",e):(window.opener.postMessage("ready","https://maimaidx-eng.com"),window.opener.postMessage("ready","https://maimaidx.jp"))}};const t=new URLSearchParams(document.location.search);let n=t.get("gameVersion")===g.DX_PLUS_GAME_VERSION.toString(),a="hide"!==t.get("quickLookup");this.state={isDxPlus:n,showMultiplierTable:a},this.initWindowCommunication()}render(){const{isDxPlus:e,showMultiplierTable:t,ratingData:n}=this.state;return r.default.createElement(r.default.Fragment,null,r.default.createElement(I.VersionSelect,{isDxPlus:e,handleVersionSelect:this.selectVersion}),r.default.createElement(p.InnerLvInput,{ref:this.lvInput}),r.default.createElement(R.ScoreInput,{ref:this.scoreInput}),r.default.createElement("div",{className:"actionArea"},r.default.createElement("button",{id:"calculateRatingBtn",onClick:this.handleButtonClick},"計算 Rating 值")),r.default.createElement("hr",{className:"sectionSep"}),r.default.createElement("div",{className:"outputArea hidden"},r.default.createElement("h2",{id:"outputHeading"},s.UIString.analysisResult),n&&r.default.createElement(b.RatingOverview,{newChartsRating:n.newChartsRating,oldChartsRating:n.oldChartsRating,isDxPlus:e,playerGradeIndex:this.playerGradeIndex}),r.default.createElement("div",{className:"ratingObjectDistribution"},r.default.createElement("h3",null,"Rating 對象曲等級與成績分布"),r.default.createElement("div",{className:"flexRow"},r.default.createElement("table",{id:"lrDistTable"},r.default.createElement("thead",{id:"lrDistThead"}),r.default.createElement("tbody",{id:"lrDistTbody"})),r.default.createElement("table",{id:"drDistTable"},r.default.createElement("thead",{id:"drDistThead"}),r.default.createElement("tbody",{id:"drDistTbody"})))),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement("h3",null,"▶ 新譜面 Rating 對象曲目 (取最佳 15 首)："),r.default.createElement("table",{className:"songRecordTable topRecordTable"},r.default.createElement("thead",{id:"newTopSongsThead"}),r.default.createElement("tbody",{id:"newTopSongsTbody"}))),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement("h3",null,"▶ 舊譜面 Rating 對象曲目 (取最佳 25 首)："),r.default.createElement("table",{className:"songRecordTable topRecordTable"},r.default.createElement("thead",{id:"oldTopSongsThead"}),r.default.createElement("tbody",{id:"oldTopSongsTbody"}))),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement("h3",null,"▷ 新譜面 Rating 候選曲目："),r.default.createElement("table",{className:"songRecordTable candidateTable"},r.default.createElement("thead",{id:"newCandidateSongsThead"}),r.default.createElement("tbody",{id:"newCandidateSongsTbody"}))),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement("h3",null,"▷ 舊譜面 Rating 候選曲目："),r.default.createElement("table",{className:"songRecordTable candidateTable"},r.default.createElement("thead",{id:"oldCandidateSongsThead"}),r.default.createElement("tbody",{id:"oldCandidateSongsTbody"}))),r.default.createElement("hr",{className:"sectionSep"})),t&&r.default.createElement(S.MultiplierTable,{isDxPlus:e}),r.default.createElement(v.OtherTools,null),r.default.createElement(E.PageFooter,null))}calculateAndShowRating(){const e=this.lvInput.current?this.lvInput.current.getInput():"",t=this.scoreInput.current?this.scoreInput.current.getInput():"";y(this.state.isDxPlus,e,t).then(e=>{this.setState({ratingData:e})})}}t.RootComponent=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeToCache=t.readFromCache=void 0;t.readFromCache=function(e){const t=window.localStorage.getItem(e);if(console.log('Reading cache for "'+e+'" =>',t),!t)return null;const n=JSON.parse(t),a=new Date(n.date);return(new Date).valueOf()-a.valueOf()>6048e5?(console.warn('Cache for "'+e+'" is expired.'),window.localStorage.removeItem(e),null):n.content},t.writeToCache=function(e,t){console.log('Updating cache for "'+e+'"');const n={date:new Date,content:t};window.localStorage.setItem(e,JSON.stringify(n))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCandidateSongs=void 0;const a=n(1),o=n(34),r=n(8),l=n(2);function i(e,t,n){const r=a.getRankIndexByAchievement(e.achievement,t),l=new Map;if(r<=0)return l;const i=a.getRankDefinitions(t);for(let a=r-1;a>=0;a--){const r=i[a];if(r.title===i[a+1].title)continue;const[s,c]=o.calculateRatingRange(e.level,r,t);c>=n&&l.set(r.title,{minRt:s,rank:r})}return l}t.getCandidateSongs=function(e,t,n){const a=[];if(t<=0)return a;const o=e[t-1].rating;for(let r=t;r<e.length;r++){const t=e[r];if(t.achievement<l.SSSPLUS_MIN_ACHIEVEMENT){const e=i(t,n,o);if(!e.size)continue;if(t.nextRanks=e,a.push(t),a.length>=50)break}}return a.sort(r.getSongsByNextRatingComparator(o-10)),a.slice(0,20)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateRatingRange=void 0;const a=n(1);t.calculateRatingRange=function(e,t,n){const o=a.getRankDefinitions(n),r=o.indexOf(t),l=r>=1?o[r-1].th-1e-4:t.th;return[Math.floor(e*t.th*t.factor/100),Math.floor(e*l*t.factor/100)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGradeByIndex=void 0;const a=[{title:"",bonus:0},{title:"初心者",bonus:0},{title:"見習い",bonus:100},{title:"駆け出し",bonus:200},{title:"修行中",bonus:300},{title:"初段",bonus:400},{title:"二段",bonus:500},{title:"三段",bonus:600},{title:"四段",bonus:700},{title:"五段",bonus:800},{title:"六段",bonus:900},{title:"七段",bonus:1e3},{title:"八段",bonus:1200},{title:"九段",bonus:1400},{title:"十段",bonus:1600},{title:"皆伝",bonus:1800},{title:"壱皆伝",bonus:2e3},{title:"弐皆伝",bonus:2100},{title:"参皆伝",bonus:2100},{title:"肆皆伝",bonus:2100},{title:"伍皆伝",bonus:2100},{title:"陸皆伝",bonus:2100},{title:"漆皆伝",bonus:2100},{title:"捌皆伝",bonus:2100},{title:"玖皆伝",bonus:2100},{title:"拾皆伝",bonus:2100}],o=[{title:"",bonus:0},{title:"初心者",bonus:0},{title:"見習い",bonus:250},{title:"駆け出し",bonus:500},{title:"修行中",bonus:750},{title:"初段",bonus:1e3},{title:"二段",bonus:1200},{title:"三段",bonus:1400},{title:"四段",bonus:1500},{title:"五段",bonus:1600},{title:"六段",bonus:1700},{title:"七段",bonus:1800},{title:"八段",bonus:1850},{title:"九段",bonus:1900},{title:"十段",bonus:1950},{title:"皆伝",bonus:2e3},{title:"壱皆伝",bonus:2010},{title:"弐皆伝",bonus:2020},{title:"参皆伝",bonus:2030},{title:"肆皆伝",bonus:2040},{title:"伍皆伝",bonus:2050},{title:"陸皆伝",bonus:2060},{title:"漆皆伝",bonus:2070},{title:"捌皆伝",bonus:2080},{title:"玖皆伝",bonus:2090},{title:"拾皆伝",bonus:2100}];t.getGradeByIndex=function(e,t){return(t?o:a)[e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseInnerLevelLine=void 0;const a=/\bdx\s*:\s*([0-9]+)/,o=/\blv\s*:\s*(\[.+?\])/,r=/\bv\s*:\s*([0-9]+)/,l=/\bn\s*:\s*["'](.+?)['"]\s*[,\}]/,i=/\bnn\s*:\s*["'](.+?)['"]\s*[,\}]/;t.parseInnerLevelLine=function(e){const t=e.match(a),n=e.match(o),s=e.match(r),c=e.match(l),u=e.match(i);if(t&&n&&s&&c)return{dx:parseInt(t[1]),lv:JSON.parse(n[1]),debut:parseInt(s[1]),songName:c[1],nickname:u&&u[1]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iWantSomeMagic=void 0;const a=[105,117,117,113,116,59,48,48,116,104,106,110,102,115,98,47,104,106,117,105,118,99,47,106,112,48,110,98,106,96,83,98,117,106,111,104,66,111,98,109,122,123,102,115,48,116,100,115,106,113,117,116,96,110,98,106,110,98,106,48,106,111,96,109,119,96,101,121,47,107,116],o=[113,109,118,116];t.iWantSomeMagic=function(e){const t=a.map(e=>e-1);return e&&t.splice(t.length-3,0,...o.map(e=>e-1)),String.fromCharCode(...t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseScoreLine=void 0;const a=n(1),o=n(2);function r(e){if(!e)return 1;const t=parseInt(e);return e.endsWith("+")?t+.7:t}t.parseScoreLine=function(e,t){const[n,l,i,s,c,u]=e.split("\t");if(n&&l&&i&&s&&c&&u){const e=parseFloat(u),d=function(e,t){e=Math.min(e,o.SSSPLUS_MIN_ACHIEVEMENT);const n=a.getRankByAchievement(e,t);n||console.warn(`Could not find rank for achievement ${e.toFixed(4)}%`);const r=n?n.factor:5;return{factor:r,multiplier:r*e/100}}(e,t);return{songName:n,genre:l,difficulty:i,level:r(s),levelIsEstimate:!0,chartType:c,achievement:e,multiplier:d.multiplier,rankFactor:d.factor}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderRankDistributionPerDifficulty=t.renderRankDistributionPerLevel=void 0;const a=n(1),o=n(2),r=["officialLevelCell"];function l(e){const t=new Map;for(const e of a.getRankDefinitions(!0))t.set(e.title,0);return e.forEach(e=>{const n=a.getRankTitle(e.achievement),o=t.get(n);t.set(n,o+1)}),t}function i(e,t,n,a,o,r){const l=document.createElement("tr");let i;return a&&l.classList.add(a),e.forEach((e,n)=>{const a=t||0===n?"th":"td";i=document.createElement(a),i.innerText=e,i.classList.add(o),n<r.length&&i.classList.add(r[n]),l.appendChild(i)}),n&&i.classList.add("totalCell"),l}function s(e,t,n,o){const r=[""];for(const t of a.getRankDefinitions(!0))if(r.push(t.title),t.title===e)break;return t&&r.push("TOTAL"),i(r,!0,t,"",n,o)}function c(e,t,n,a,o,r,l){const s=[e];let c=0;for(const[e,a]of t)if(s.push(a),c+=a,e===n)break;return a&&s.push(c.toString()),i(s,!1,a,o,r,l)}t.renderRankDistributionPerLevel=function(e,t,n){t.innerHTML="",n.innerHTML="";const a=new Map;o.OFFICIAL_LEVELS.forEach(e=>{a.set(e,[])}),e.forEach(e=>{const t=function(e){const t=Math.floor(e);return e-t>.6?t+"+":t.toString()}(e.level);a.get(t).push(e)});const i=l(e);let u;for(const[e,t]of i)t>0&&(u=e);t.appendChild(s(u,!1,"levelRankCell",r));for(const[e,t]of a)if(t.length>0){const a=l(t);n.appendChild(c(e,a,u,!1,"","levelRankCell",r))}},t.renderRankDistributionPerDifficulty=function(e,t,n){t.innerHTML="",n.innerHTML="";const a=new Map,r=[].concat(o.DIFFICULTIES);r.reverse(),r.forEach(e=>{a.set(e,[])}),e.forEach(e=>{a.get(e.difficulty).push(e)});const i=l(e);let u;for(const[e,t]of i)t>0&&(u=e);t.appendChild(s(u,!0,"diffRankCell",["difficultyRankDistHead"]));for(const[e,t]of a)if(t.length>0){const a=l(t);n.appendChild(c(e,a,u,!0,o.DIFFICULTY_CLASSNAME_MAP.get(e),"diffRankCell",[]))}}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function l(e){try{s(a.next(e))}catch(e){r(e)}}function i(e){try{s(a.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}s((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzePlayerRating=void 0;const o=n(8),r=n(2);function l(e){return"DX"===e}function i(e,t,n){return"Link"===e?t.includes("niconico")?"Link(nico)":"Link(org)":l(n)?e+"[dx]":e}function s(e,t,n,a){let o=e.get(t);if(o&&o.length>0){if(o.length>1){const e=l(a)?1:0;if(o=o.filter(t=>t.dx===e),o.length>1){const e=i(t,n);o=o.filter(t=>t.nickname===e)}}if(1===o.length)return o[0]}return console.warn("Could not find song properties for "+t),null}function c(e,t){if(t){const n=r.DIFFICULTIES.indexOf(e.difficulty),a=t.lv[n];"number"==typeof a&&(e.levelIsEstimate=a<0,e.level=Math.abs(a))}if(e.levelIsEstimate){const t=i(e.songName,e.genre,e.chartType)+" - "+e.difficulty+" "+e.level;console.warn("Missing inner lv data for "+t)}return Object.assign(Object.assign({},e),{rating:e.level*e.multiplier})}t.analyzePlayerRating=function(e,t,n){return a(this,void 0,void 0,(function*(){const a=[],r=[];for(const o of t){const t=s(e,o.songName,o.genre,o.chartType);let l="STANDARD"===o.chartType;t&&(l=t.debut!==n);const i=c(o,t);l?r.push(i):a.push(i)}a.sort(o.compareSongsByRating),r.sort(o.compareSongsByRating);let l=0;const i=Math.min(15,a.length);for(let e=0;e<i;e++)l+=Math.floor(a[e].rating);let u=0;const d=Math.min(25,r.length);for(let e=0;e<d;e++)u+=Math.floor(r[e].rating);return{newSongScores:a,newChartsRating:l,newTopChartsCount:i,oldSongScores:r,oldChartsRating:u,oldTopChartsCount:d}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderSongScores=void 0;const a=n(1),o=n(2),r=["orderCell","songTitleCell","difficultyCell","innerLvCell","achievementCell","rankFactorCell","ratingCell"];function l(e,t,n){const a=document.createElement("tr");for(const e of t)a.classList.add(e);return e.forEach((e,t)=>{const o=document.createElement(n?"th":"td");o.innerText=e,o.classList.add("scoreRecordCell"),o.classList.add(r[t]),a.append(o)}),a}t.renderSongScores=function(e,t,n,r){n.innerHTML="",r.innerHTML="",n.append(function(e){const t=["編號","歌曲","難度","譜面\n定數","達成率","Rank\n係數","Rating"];return e&&(t[t.length-2]="下個\n目標",t[t.length-1]="下個\nRating"),l(t,[],!0)}(t)),e.forEach((e,n)=>{r.append(function(e,t,n){let r=e.level.toFixed(1);e.levelIsEstimate&&(r="*"+r);const i=t?Array.from(e.nextRanks.keys()).join("\n"):`${a.getRankTitle(e.achievement)} (${e.rankFactor})`,s=t?Array.from(e.nextRanks.values()).map(e=>e.minRt).join("\n"):Math.floor(e.rating).toString();return l([n.toString(),e.songName,e.difficulty,r,e.achievement.toFixed(4)+"%",i,s],["scoreRecordRow",o.DIFFICULTY_CLASSNAME_MAP.get(e.difficulty)],!1)}(e,t,n+1))})}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InnerLvInput=void 0;const o=a(n(0)),r=n(9);class l extends o.default.PureComponent{constructor(){super(...arguments),this.state={showTextarea:!1},this.textareaRef=o.default.createRef(),this.handleRadioChange=e=>{this.setState({showTextarea:"1"===e.currentTarget.value})}}render(){const{showTextarea:e}=this.state;return o.default.createElement("div",{className:"w90"},o.default.createElement("h2",{className:"lvInputHeading"},r.UIString.innerLvHeading),o.default.createElement("form",null,o.default.createElement("label",{className:"lvFormLabel"},o.default.createElement("input",{className:"lvFormRadio",name:"showLvInput",value:"0",type:"radio",checked:!e,onChange:this.handleRadioChange}),r.UIString.autoLv),o.default.createElement("label",{className:"lvFormLabel"},o.default.createElement("input",{className:"lvFormRadio",name:"showLvInput",value:"1",type:"radio",checked:e,onChange:this.handleRadioChange}),r.UIString.manualLv)),e&&o.default.createElement("textarea",{className:"lvInput",ref:this.textareaRef}))}getInput(){return this.textareaRef.current?this.textareaRef.current.value:""}}t.InnerLvInput=l},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MultiplierTable=void 0;const o=a(n(0)),r=n(1),l=["qlRankTitleCell","qlThresholdCell"];function i(e,t,n){return o.default.createElement("tr",{className:t.join(" ")},e.map((e,t)=>{let a="qlRankFactorCell";return t<l.length&&(a+=" "+l[t]),n||0===t?o.default.createElement("th",{className:a},e):o.default.createElement("td",{className:a},e)}))}class s extends o.default.PureComponent{constructor(){super(...arguments),this.state={minRankOption:"A"}}render(){const{isDxPlus:e}=this.props,{minRankOption:t}=this.state,n=r.getRankDefinitions(e),a=n.findIndex(e=>e.title===t)+1;return o.default.createElement("div",{className:"quickLookup"},o.default.createElement("h2",{className:"quickLookupHeading"},"Rank 係數表"),o.default.createElement("table",{className:"quickLookupTable"},o.default.createElement("thead",null,i(["Rank","達成率","係數","倍率 (係數 × 達成率)"],[],!0)),o.default.createElement("tbody",null,n.slice(0,a).map((e,t,n)=>{const a=e.th*e.factor/100,o=t>0?(n[t-1].th-1e-4)*e.factor/100:a,r=a.toFixed(3),l=o.toFixed(3),s=r!==l?`${r} - ${l}`:r;return i([e.title,e.th.toString(),e.factor.toString(),s],[],!1)}))),o.default.createElement("hr",{className:"sectionSep"}))}}t.MultiplierTable=s},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreInput=void 0;const o=a(n(0)),r=n(9);class l extends o.default.PureComponent{constructor(){super(...arguments),this.textareaRef=o.default.createRef()}render(){return o.default.createElement("div",{className:"w90"},o.default.createElement("h2",{className:"scoreInputHeading"},r.UIString.scoreInputHeading),o.default.createElement("div",null,r.UIString.scoreInputDescPrefix,o.default.createElement("a",{href:"/mai-tools/bookmarklets/",target:"_blank"},r.UIString.bookmarketLinkLabel),r.UIString.scoreInputDescSuffix),o.default.createElement("textarea",{className:"scoreInputArea",ref:this.textareaRef}))}getInput(){return this.textareaRef.current?this.textareaRef.current.value:""}setText(e){this.textareaRef.current&&(this.textareaRef.current.value=e)}appendText(e){this.textareaRef.current&&(this.textareaRef.current.value+=e+"\n")}}t.ScoreInput=l},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VersionSelect=void 0;const o=a(n(0));class r extends o.default.PureComponent{constructor(){super(...arguments),this.handleChange=e=>{this.props.handleVersionSelect(parseInt(e.currentTarget.value))}}render(){const{isDxPlus:e}=this.props;return o.default.createElement("div",null,o.default.createElement("label",{htmlFor:"gameVersion"},"遊戲版本："),o.default.createElement("select",{id:"gameVersion",onChange:this.handleChange},o.default.createElement("option",{value:"13",selected:!e},"DX"),o.default.createElement("option",{value:"14",selected:e},"DX Plus")))}}t.VersionSelect=r},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OtherTools=void 0;const o=a(n(0)),r=n(9);class l extends o.default.PureComponent{render(){return o.default.createElement("div",{className:"otherToolsContainer"},o.default.createElement("h2",{className:"otherToolsHeading"},r.UIString.otherToolsHeading),o.default.createElement("ul",null,o.default.createElement("li",{className:"toolItem"},o.default.createElement("a",{href:"../rating-visualizer/"},r.UIString.ratingVisualizer)),o.default.createElement("li",{className:"toolItem"},o.default.createElement("a",{href:"../bookmarklets/"},r.UIString.bookmarketList)),o.default.createElement("li",{className:"toolItem"},o.default.createElement("a",{href:"../"},r.UIString.scoreConverter))),o.default.createElement("hr",{className:"sectionSep"}))}}t.OtherTools=l},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageFooter=void 0;const o=a(n(0));class r extends o.default.PureComponent{render(){return o.default.createElement("footer",null,"Made by"," ",o.default.createElement("a",{className:"authorLink",href:"https://github.com/myjian/"},"myjian"),".")}}t.PageFooter=r},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RatingOverview=void 0;const o=a(n(0)),r=n(35),l=n(9);class i extends o.default.PureComponent{render(){const{oldChartsRating:e,newChartsRating:t,playerGradeIndex:n,isDxPlus:a}=this.props;let i=t+e;const s=n>0?r.getGradeByIndex(n,a):null;return s&&(i+=s.bonus),o.default.createElement("div",{className:"ratingOverview"},o.default.createElement("div",{className:"totalRatingRow"},"Rating： ",o.default.createElement("span",null,i)),o.default.createElement("table",null,o.default.createElement("tbody",null,o.default.createElement("tr",null,o.default.createElement("td",null,l.UIString.newChartsRating),o.default.createElement("td",null,l.UIString.column),o.default.createElement("td",null,e)),o.default.createElement("tr",null,o.default.createElement("td",null,l.UIString.oldChartsRating),o.default.createElement("td",null,l.UIString.column),o.default.createElement("td",null,t)),s&&o.default.createElement("tr",null,o.default.createElement("td",null,l.UIString.grade," (",o.default.createElement("span",null,s.title),")"),o.default.createElement("td",null,l.UIString.column),o.default.createElement("td",null,s.bonus)))))}}t.RatingOverview=i}]);